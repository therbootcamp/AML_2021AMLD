<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Prediction</title>

<script src="Prediction_practical_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="Prediction_practical_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="Prediction_practical_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="Prediction_practical_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="Prediction_practical_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="Prediction_practical_files/navigation-1.1/tabsets.js"></script>
<link href="Prediction_practical_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="Prediction_practical_files/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="practical.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Prediction</h1>
<h4 class="author"><table style='table-layout:fixed;width:100%;border:0;padding:0;margin:0'>
<col width='10%'>
<col width='10%'>
<tr style="border:none">
<td style="display:block;width:100%;text-align:left;vertical-align:bottom;padding:0;margin:0;border:none" nowrap>
<font style='font-style:normal'>Applied Machine Learning with R</font><br> <a href='https://therbootcamp.github.io/AML_2020AMLD/'> <i class='fas fa-clock' style='font-size:.9em;' ></i> </a> <a href='https://therbootcamp.github.io'> <i class='fas fa-home' style='font-size:.9em;'></i> </a> <a href='mailto:therbootcamp@gmail.com'> <i class='fas fa-envelope' style='font-size: .9em;'></i> </a> <a href='https://www.linkedin.com/company/basel-r-bootcamp/'> <i class='fab fa-linkedin' style='font-size: .9em;'></i> </a> <a href='https://therbootcamp.github.io'> <font style='font-style:normal'>The R Bootcamp @ AMLD</font> </a>
</td>
<td style="width:100%;vertical-align:bottom;text-align:right;padding:0;margin:0;border:none">
<img src='https://raw.githubusercontent.com/therbootcamp/therbootcamp.github.io/master/_sessions/_image/by-sa.png' style='height:15px;width:80px'/>
</td>
</tr>
</table></h4>

</div>


<p align="center">
<img width="100%" src="https://cdn-images-1.medium.com/max/1200/0*F0y1bmOEzCFCcPE_" margin=0><br> <font style="font-size:10px">from <a href="https://Medium.com/">Medium.com</a></font>
</p>
<div id="section" class="section level1 tabset">
<h1></h1>
<div id="overview" class="section level2">
<h2>Overview</h2>
<p>By the end of this practical you will know how to:</p>
<ol style="list-style-type: decimal">
<li>Fit regression, decision trees and random forests to training data.</li>
<li>Evaluate model fitting <em>and</em> prediction performance in a test set.</li>
<li>Compare the fitting and prediction performance of two models.</li>
<li>Explore the effects of features on model predictions.</li>
</ol>
</div>
<div id="tasks" class="section level2">
<h2>Tasks</h2>
<div id="a---setup" class="section level3">
<h3>A - Setup</h3>
<ol style="list-style-type: decimal">
<li><p>Open your <code>RBootcamp_AMLD2020</code> R project. It should already have the folders <code>1_Data</code> and <code>2_Code</code>. Make sure that the data file(s) listed in the <code>Datasets</code> section are in your <code>1_Data</code> folder.</p></li>
<li><p>Open a new R script and save it as a new file called <code>Prediction_College_practical.R</code> in the <code>2_Code</code> folder.</p></li>
<li><p>Using <code>library()</code> load the set of packages for this practical listed in the packages section above.</p></li>
</ol>
<pre class="r"><code># Load packages necessary for this script
library(tidyverse)
library(caret)
library(party)
library(partykit)</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Run the code below to load each of the datasets listed in the <code>Datasets</code> as new objects.</li>
</ol>
<pre class="r"><code># College data
college_train &lt;- read_csv(file = &quot;1_Data/college_train.csv&quot;)
college_test &lt;- read_csv(file = &quot;1_Data/college_test.csv&quot;)</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Take a look at the first few rows of each dataframe by printing them to the console.</li>
</ol>
<pre class="r"><code># Print dataframes to the console
college_train
college_test</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Open each dataset in a new window using <code>View()</code>. Do they look ok?</li>
</ol>
<pre class="r"><code># Open each dataset in a window.
View(XXX)
View(XXX)</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Again, We need to do a little bit of data cleaning. Specifically, we need to convert all character columns to factors: Do this by running the following code:</li>
</ol>
<pre class="r"><code># Convert all character columns to factor
college_train &lt;- college_train %&gt;%
          mutate_if(is.character, factor)

college_test &lt;- college_test %&gt;%
          mutate_if(is.character, factor)</code></pre>
</div>
<div id="b---fitting" class="section level3">
<h3>B - Fitting</h3>
<p>Your goal in this set of tasks is again to fit models predicting <code>Grad.Rate</code>, the percentage of attendees who graduate from each college.</p>
<ol style="list-style-type: decimal">
<li>Using <code>trainControl()</code>, set your training control method to <code>&quot;none&quot;</code>. Save your object as <code>ctrl_none</code>.</li>
</ol>
<pre class="r"><code># Set training method to &quot;none&quot; for simple fitting
#  Note: This is for demonstration purposes, you would almost
#   never do this for a &#39;real&#39; prediction task!
ctrl_none &lt;- trainControl(method = &quot;XXX&quot;)</code></pre>
<div id="regression" class="section level4">
<h4>Regression</h4>
<ol start="2" style="list-style-type: decimal">
<li>Using <code>train()</code> fit a regression model called <code>grad_glm</code> predicting <code>Grad.Rate</code> as a function of all features. Specifically,…</li>
</ol>
<ul>
<li>for the <code>form</code> argument, use <code>Grad.Rate ~ .</code>.</li>
<li>for the <code>data</code> argument, use <code>college_train</code> in the data argument.</li>
<li>for the <code>method</code> argument, use <code>method = &quot;glm&quot;</code> for regression.</li>
<li>for the <code>trControl</code> argument, use your <code>ctrl_none</code> object you created before.</li>
</ul>
<pre class="r"><code>grad_glm &lt;- train(form = XX ~ .,
                  data = XX,
                  method = &quot;XXX&quot;,
                  trControl = ctrl_none)</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Explore your <code>grad_glm</code> object by looking at <code>grad_glm$finalModel</code> and using <code>summary()</code>, what do you find?</li>
</ol>
<pre class="r"><code>grad_glm$XXX
summary(XXX)</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Using <code>predict()</code> save the fitted values of <code>grad_glm</code> object as <code>glm_fitted</code>.</li>
</ol>
<pre class="r"><code># Save fitted values of regression model
glm_fitted &lt;- predict(XXX)</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Print your <code>glm_fitted</code> object, look at summary statistics with <code>summary(glm_fitted)</code>, and create a histogram with <code>hist()</code> do they make sense?</li>
</ol>
<pre class="r"><code># Explore regression model fits
XXX
summary(XXX)
hist(XXX)</code></pre>
</div>
<div id="decision-trees" class="section level4">
<h4>Decision Trees</h4>
<ol start="6" style="list-style-type: decimal">
<li>Using <code>train()</code>, fit a decision tree model called <code>grad_rpart</code>. Specifically,…</li>
</ol>
<ul>
<li>for the <code>form</code> argument, use <code>Grad.Rate ~ .</code>.</li>
<li>for the <code>data</code> argument, use <code>college_train</code>.</li>
<li>for the <code>method</code> argument, use <code>method = &quot;rpart&quot;</code> to create decision trees.</li>
<li>for the <code>trControl</code> argument, use your <code>ctrl_none</code> object you created before.</li>
<li>for the <code>tuneGrid</code> argument, use <code>cp = 0.01</code> to specify the value of the complexity parameter. This is a relatively low value which means your trees will be, relatively, complex, i.e., deep.</li>
</ul>
<pre class="r"><code>grad_rpart &lt;- train(form = XX ~ .,
                  data = XXX,
                  method = &quot;XX&quot;,
                  trControl = XX,
                  tuneGrid = expand.grid(cp = XX))   # Set complexity parameter</code></pre>
<ol start="7" style="list-style-type: decimal">
<li><p>Explore your <code>grad_rpart</code> object by looking at <code>grad_rpart$finalModel</code> and plotting it with <code>plot(as.party(grad_rpart$finalModel))</code>, what do you find?</p></li>
<li><p>Using <code>predict()</code>, save the fitted values of <code>grad_rpart</code> object as <code>rpart_fitted</code>.</p></li>
</ol>
<pre class="r"><code># Save fitted values of decision tree model
rpart_fitted &lt;- predict(XXX)</code></pre>
<ol start="9" style="list-style-type: decimal">
<li>Print your <code>rpart_fitted</code> object, look at summary statistics with <code>summary(rpart_fitted)</code>, and create a histogram with <code>hist()</code>. Do they make sense?</li>
</ol>
<pre class="r"><code># Explore decision tree fits
XXX
summary(XXX)
hist(XXX)</code></pre>
</div>
<div id="random-forests" class="section level4">
<h4>Random Forests</h4>
<ol start="10" style="list-style-type: decimal">
<li>Using <code>train()</code>, fit a random forest model called <code>grad_rf</code>. Speicifically,…</li>
</ol>
<ul>
<li>for the <code>form</code> argument, use <code>Grad.Rate ~ .</code>.</li>
<li>for the <code>data</code> argument, use <code>college_train</code>.</li>
<li>for the <code>method</code> argument, use <code>method = &quot;rf&quot;</code> to fit random forests.</li>
<li>for the <code>trControl</code> argument, use your <code>ctrl_none</code> object you created before.</li>
<li>for the <code>mtry</code> parameter, use <code>mtry</code> = 2. This is a relatively low value, so the forest will be very diverse.</li>
</ul>
<pre class="r"><code>grad_rf &lt;- train(form = XX ~ .,   # Predict grad
                 data = XX,
                 method = &quot;XX&quot;,
                 trControl = XX,
                 tuneGrid = expand.grid(mtry = XX))  # Set number of features randomly selected</code></pre>
<ol start="11" style="list-style-type: decimal">
<li>Using <code>predict()</code>, save the fitted values of <code>grad_rf</code> object as <code>rf_fitted</code>.</li>
</ol>
<pre class="r"><code># Save fitted values of random forest model
rf_fitted &lt;- predict(XXX)</code></pre>
<ol start="12" style="list-style-type: decimal">
<li>Print your <code>rf_fitted</code> object, look at summary statistics with <code>summary(rf_fitted)</code>, and create a histogram with <code>hist()</code>. Do they make sense?</li>
</ol>
<pre class="r"><code># Explore random forest fits
XXX
summary(XXX)
hist(XXX)</code></pre>
</div>
<div id="assess-accuracy" class="section level4">
<h4>Assess accuracy</h4>
<ol start="13" style="list-style-type: decimal">
<li>Save the true training criterion values (<code>college_train$Grad.Rate</code>) as a vector called <code>criterion_train</code>.</li>
</ol>
<pre class="r"><code># Save training criterion values
criterion_train &lt;- XXX$XXX</code></pre>
<ol start="14" style="list-style-type: decimal">
<li>Using <code>postResample()</code>, determine the fitting performance of each of your models separately. Make sure to set your <code>criterion_train</code> values to the <code>obs</code> argument, and your true model fits <code>XX_fitted</code> to the <code>pred</code> argument.</li>
</ol>
<pre class="r"><code># Calculate fitting accuracies of each model
# pred = XX_fitted
# obs = criterion_train

# Regression
postResample(pred = XXX, obs = XXX)

# Decision Trees
postResample(pred = XXX, obs = XXX)

# Random Forests
postResample(pred = XXX, obs = XXX)</code></pre>
<ol start="15" style="list-style-type: decimal">
<li>Which one had the best fit? What was the fitting MAE of each model? Optional: If you’d like to, try visualizing the fitting results using the plotting code shown in the Examples tab above.</li>
</ol>
</div>
</div>
<div id="c---prediction" class="section level3">
<h3>C - Prediction</h3>
<ol style="list-style-type: decimal">
<li>Save the criterion values from the test data set <code>college_test$Grad.Rate</code> as a new vector called <code>criterion_test</code>.</li>
</ol>
<pre class="r"><code># Save criterion values
criterion_test &lt;- XXX$XXX</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Using <code>predict()</code>, save the predicted values of each model for the test data <code>college_test</code> as <code>glm_pred</code>, <code>rpart_pred</code> and <code>rf_pred</code>.</li>
</ol>
<pre class="r"><code># Save model predictions for test data
# newdata = college_test

# Regression
glm_pred &lt;- predict(XXX, newdata = XXX)

# Decision Trees
rpart_pred &lt;- predict(XXX, newdata = XXX)

# Random Forests
rf_pred &lt;- predict(XXX, newdata = XXX)</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Using <code>postResample()</code>, determine the <em>prediction</em> performance of each of your models against the test criterion <code>criterion_test</code>.</li>
</ol>
<pre class="r"><code># Calculate prediction accuracies of each model
# obs = criterion_test
# pred = XX_pred

# Regression
postResample(pred = XXX, obs = XXX)

# Decision Trees
postResample(pred = XXX, obs = XXX)

# Random Forests
postResample(pred = XXX, obs = XXX)</code></pre>
<ol start="4" style="list-style-type: decimal">
<li><p>How does each model’s <em>prediction or test</em> performance (on the <code>XXX_test</code> data) compare to its <em>fitting or training</em> performance (on the <code>XXX_train</code> data)? Is it worse? Better? The same? What does the change tell you about the models?</p></li>
<li><p>Which of the three models has the best prediction performance?</p></li>
<li><p>If you had to use one of these three models in the real-world, which one would it be? Why?</p></li>
<li><p>If someone came to you and asked “If I use your model in the future to predict the graduation rate of a new college, how accurate do you think it would be?”, what would you say?</p></li>
</ol>
</div>
<div id="d---a-different-data-set-house-prices-in-king-county-washington" class="section level3">
<h3>D - A different data Set House Prices in King County, Washington</h3>
<p>In this section, we will work with a different data set. Specifically, we will predict the prices of houses in King County Washington (home of Seattle, <a href="https://qz.com/208457/a-cartographic-guide-to-starbucks-global-domination/">which you can thank for this</a>) using the <code>house_train</code> and <code>house_test</code> datasets.</p>
<div id="setup" class="section level4">
<h4>Setup</h4>
<ol style="list-style-type: decimal">
<li>Run the code below to load each of the datasets listed in the <code>Datasets</code> as new objects.</li>
</ol>
<pre class="r"><code># house data
house_train &lt;- read_csv(file = &quot;1_Data/house_train.csv&quot;)
house_test &lt;- read_csv(file = &quot;1_Data/house_test.csv&quot;)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><p>Take a look at the first few rows of each dataframe by printing them to the console.</p></li>
<li><p>Open each dataset in a new window using <code>View()</code>. Do they look ok?</p></li>
</ol>
<pre class="r"><code># Open each dataset in a window.
View(XXX)
View(XXX)</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Again, we need to do a little bit of data cleaning. Convert all character columns to factor.</li>
</ol>
<pre class="r"><code># Convert all character columns to factor
house_train &lt;- house_train %&gt;%
          mutate_if(is.character, factor)

house_test &lt;- house_test %&gt;%
          mutate_if(is.character, factor)</code></pre>
</div>
<div id="fitting" class="section level4">
<h4>Fitting</h4>
<p>Your goal in the following models is to predict <code>price</code>, the selling price of homes in King County WA.</p>
<ol style="list-style-type: decimal">
<li>Using <code>trainControl()</code>, set your training control method to <code>&quot;none&quot;</code>. Save your object as <code>ctrl_none</code>.</li>
</ol>
<pre class="r"><code># Set training method to &quot;none&quot; for simple fitting
#  Note: This is for demonstration purposes, you would almost
#   never do this for a &#39;real&#39; prediction task!
ctrl_none &lt;- trainControl(method = &quot;XXX&quot;)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Using <code>train()</code>, fit a regression model called <code>price_glm</code> predicting <code>price</code> using all features in <code>house_train</code>. Specifically,…</li>
</ol>
<ul>
<li>for the <code>form</code> argument, use <code>price ~ .</code>.</li>
<li>for the <code>data</code> argument, use <code>house_train</code>.</li>
<li>for the <code>method</code> argument, use <code>method = &quot;glm&quot;</code> for regression.</li>
<li>for the <code>trControl</code> argument, use your <code>ctrl_none</code> object you created before.</li>
</ul>
<pre class="r"><code>price_glm &lt;- train(form = XX ~ .,
                  data = XX,
                  method = &quot;XXX&quot;,
                  trControl = ctrl_none)</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Using <code>predict()</code>, save the fitted values of <code>price_glm</code> object as <code>glm_fitted</code>.</li>
</ol>
<pre class="r"><code># Save fitted values of regression model
glm_fitted &lt;- predict(XXX)</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Using <code>train()</code>, fit a decision tree model called <code>price_rpart</code> predicting <code>price</code> using all features in <code>house_train</code>. Specifically,…</li>
</ol>
<ul>
<li>for the <code>form</code> argument, use <code>price ~ .</code>.</li>
<li>for the <code>data</code> argument, use <code>house_train</code>.</li>
<li>for the <code>method</code> argument, use <code>method = &quot;rpart&quot;</code> to create decision trees.</li>
<li>for the <code>trControl</code> argument, use your <code>ctrl_none</code> object you created before.</li>
<li>for the <code>tuneGrid</code> argument, use <code>cp = 0.01</code> to specify the value of the complexity parameter. This is a pretty low value which means your trees will be, relatively, complex.</li>
</ul>
<pre class="r"><code>price_rpart &lt;- train(form = XX ~ .,
                  data = XXX,
                  method = &quot;XX&quot;,
                  trControl = XX,
                  tuneGrid = expand.grid(cp = XX))   # Set complexity parameter</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Using <code>predict()</code> save the fitted values of <code>price_rpart</code> object as <code>rpart_fitted</code>.</li>
</ol>
<pre class="r"><code># Save fitted values of decision tree model
rpart_fitted &lt;- predict(XXX)</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Using <code>train()</code>, fit a random forest model called <code>price_rf</code> predicting <code>price</code> using all features in <code>house_train</code>. Specifically,…</li>
</ol>
<ul>
<li>for the <code>form</code> argument, use <code>price ~ .</code>.</li>
<li>for the <code>data</code> argument, use <code>house_train</code> in the data argument.</li>
<li>for the <code>method</code> argument, use <code>method = &quot;rf&quot;</code> to fit random forests.</li>
<li>for the <code>trControl</code> argument, use your <code>ctrl_none</code> object you created before.</li>
<li>for the <code>mtry</code> parameter, use <code>mtry</code> = 2. This is a relatively low value, so the forest will be very diverse.</li>
</ul>
<pre class="r"><code>price_rf &lt;- train(form = XX ~ .,
                 data = XX,
                 method = &quot;XX&quot;,
                 trControl = XX,
                 tuneGrid = expand.grid(mtry = XX))  # Set number of features randomly selected</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Using <code>predict()</code> save the fitted values of <code>price_rf</code> object as <code>rf_fitted</code>.</li>
</ol>
<pre class="r"><code># Save fitted values of random forest model
rf_fitted &lt;- predict(XXX)</code></pre>
</div>
<div id="assess-fitting-accuracy" class="section level4">
<h4>Assess fitting accuracy</h4>
<ol start="13" style="list-style-type: decimal">
<li>Save the true training criterion values (<code>house_train$price</code>) as a vector called <code>criterion_train</code>.</li>
</ol>
<pre class="r"><code># Save training criterion values
criterion_train &lt;- XXX$XXX</code></pre>
<ol start="14" style="list-style-type: decimal">
<li>Using <code>postResample()</code>, determine the fitting performance of each of your models separately. Make sure to set your <code>criterion_train</code> values to the <code>obs</code> argument, and your true model fits <code>XX_fitted</code> to the <code>pred</code> argument.</li>
</ol>
<pre class="r"><code># Calculate fitting accuracies of each model
# pred = XX_fitted
# obs = criterion_train

# Regression
postResample(pred = XXX, obs = XXX)

# Decision Trees
postResample(pred = XXX, obs = XXX)

# Random Forests
postResample(pred = XXX, obs = XXX)</code></pre>
<ol start="15" style="list-style-type: decimal">
<li>Which one had the best fits? What was the fitting MAE of each model? Optional: If you’d like to, try visualizing the fitting results using the plotting code shown in the Examples tab above. Ask for help if you need it!</li>
</ol>
</div>
<div id="assess-prediction-accuracy" class="section level4">
<h4>Assess prediction accuracy</h4>
<ol style="list-style-type: decimal">
<li>Save the criterion values from the test data set <code>house_test$price</code> as a new vector called <code>criterion_test</code>.</li>
</ol>
<pre class="r"><code># Save criterion values
criterion_test &lt;- XXX$XXX</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Using <code>predict()</code>, save the predicted values of each model for the test data <code>house_test</code> as <code>glm_pred</code>, <code>rpart_pred</code> and <code>rf_pred</code>.</li>
</ol>
<pre class="r"><code># Save model predictions for test data
# object: price_XXX
# newdata: house_test

# Regression
glm_pred &lt;- predict(XXX, newdata = XXX)

# Decision Trees
rpart_pred &lt;- predict(XXX, newdata = XXX)

# Random Forests
rf_pred &lt;- predict(XXX, newdata = XXX)</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Using <code>postResample()</code>, determine the <em>prediction</em> performance of each of your models against the test criterion <code>criterion_test</code>.</li>
</ol>
<pre class="r"><code># Calculate prediction accuracies of each model
# obs = criterion_test
# pred = XX_pred

# Regression
postResample(pred = XXX, obs = XXX)

# Decision Trees
postResample(pred = XXX, obs = XXX)

# Random Forests
postResample(pred = XXX, obs = XXX)</code></pre>
<ol start="4" style="list-style-type: decimal">
<li><p>How does each model’s <em>prediction or test</em> performance (on the <code>XXX_test</code> data) compare to its <em>fitting or training</em> performance (on the <code>XXX_train</code> data)? Is it worse? Better? The same? What does the change tell you about the models?</p></li>
<li><p>Which of the three models has the best prediction performance?</p></li>
<li><p>If you had to use one of these three models in the real-world, which one would it be? Why?</p></li>
<li><p>If someone came to you and asked “If I use your model in the future to predict the price of a new house, how accurate do you think it would be?”, what would you say?</p></li>
</ol>
</div>
</div>
<div id="e---exploring-model-tuning-parameters" class="section level3">
<h3>E - Exploring model tuning parameters</h3>
<ol style="list-style-type: decimal">
<li><p>In all of your decision tree models so far, you have been setting the complexity parameter to 0.01. Try setting it to a larger value of 0.2 and see how your decision trees change (by plotting them using <code>plot(as.party(XXX_rpart$finalModel))</code>). Do they get more or less complicated? How does increasing this value affect fitting and prediction performance? If you are interested in learning more about this parameter, look at the help menu with <code>?rpart.control</code>.</p></li>
<li><p>In each of your random forest models, you have been setting the <code>mtry</code> argument to 2. Try setting it to a larger value such as 5 and re-run your models. How does increasing this value affect fitting and prediction performance? If you are interested in learning more about this parameter, look at the help menu with <code>?randomForest</code>.</p></li>
<li><p>By default, the <code>train()</code> function uses 500 trees for <code>method = &quot;rf&quot;</code>. How do the number of trees affect performance? To answer this, try setting the number of trees to 1,000 (see example below) and re-evaluating your model’s training and test performance. What do you find? What if you set the number of trees to just 10?</p></li>
</ol>
<pre class="r"><code># Create random forest model with 1000 trees
mod &lt;- train(form = price ~ .,
             data = house_train,
             method = &quot;rf&quot;,
             trControl = ctrl_none,
             ntree = 1000,   # use 1000 trees! (Instead of the default value of 500)
             tuneGrid = expand.grid(mtry = 2))</code></pre>
</div>
</div>
<div id="examples" class="section level2">
<h2>Examples</h2>
<pre class="r"><code># Fitting and evaluating regression, decision trees, and random forests

# Step 0: Load packages-----------
library(tidyverse)    # Load tidyverse for dplyr and tidyr
library(caret)        # For ML mastery 
library(partykit)     # For decision trees
library(party)        # For decision trees

# Step 1: Load and Clean, and Explore Training data ----------------------

# training data
data_train &lt;- read_csv(&quot;1_Data/mpg_train.csv&quot;)

# test data
data_test &lt;- read_csv(&quot;1_Data/mpg_test.csv&quot;)

# Convert all characters to factor
#  Some ML models require factors
data_train &lt;- data_train %&gt;%
  mutate_if(is.character, factor)

data_test &lt;- data_test %&gt;%
  mutate_if(is.character, factor)

# Explore training data
data_train        # Print the dataset
View(data_train)  # Open in a new spreadsheet-like window 
dim(data_train)   # Print dimensions
names(data_train) # Print the names

# Define criterion_train
#   We&#39;ll use this later to evaluate model accuracy
criterion_train &lt;- data_train$hwy

# Step 2: Define training control parameters -------------

# In this case, I will set method = &quot;none&quot; to fit to 
#  the entire dataset without any fancy methods
ctrl_none &lt;- trainControl(method = &quot;none&quot;) 

# Step 3: Train model: -----------------------------
#   Criterion: hwy
#   Features: year, cyl, displ

# Regression --------------------------
hwy_glm &lt;- train(form = hwy ~ year + cyl + displ,
                 data = data_train,
                 method = &quot;glm&quot;,
                 trControl = ctrl_none)

# Look at summary information
hwy_glm$finalModel
summary(hwy_glm)

# Save fitted values
glm_fitted &lt;- predict(hwy_glm)

#  Calculate fitting accuracies
postResample(pred = glm_fitted, 
             obs = criterion_train)

# Decision Trees ----------------
hwy_rpart &lt;- train(form = hwy ~ year + cyl + displ,
                data = data_train,
                method = &quot;rpart&quot;,
                trControl = ctrl_none,
                tuneGrid = expand.grid(cp = .01))   # Set complexity parameter

# Look at summary information
hwy_rpart$finalModel
plot(as.party(hwy_rpart$finalModel))   # Visualise your trees

# Save fitted values
rpart_predfit &lt;- predict(hwy_rpart)

# Calculate fitting accuracies
postResample(pred = rpart_predfit, obs = criterion_train)

# Random Forests -------------------------
hwy_rf &lt;- train(form = hwy ~ year + cyl + displ,
                data = data_train,
                method = &quot;rf&quot;,
                trControl = ctrl_none,
                tuneGrid = expand.grid(mtry = 2))   # Set number of features randomly selected

# Look at summary information
hwy_rf$finalModel

# Save fitted values
rf_fitted &lt;- predict(hwy_rf)

# Calculate fitting accuracies
postResample(pred = rf_fitted, obs = criterion_train)

# Visualise Accuracy -------------------------

# Tidy competition results
accuracy &lt;- tibble(criterion_train = criterion_train,
                   Regression = glm_fitted,
                   DecisionTrees = rpart_predfit,
                   RandomForest = rf_fitted) %&gt;%
               gather(model, prediction, -criterion_train) %&gt;%
               # Add error measures
               mutate(se = prediction - criterion_train,
                      ae = abs(prediction - criterion_train))

# Calculate summaries
accuracy_agg &lt;- accuracy %&gt;%
                  group_by(model) %&gt;%
                  summarise(mae = mean(ae))   # Calculate MAE (mean absolute error)

# Plot A) Scatterplot of truth versus predictions
ggplot(data = accuracy,
       aes(x = criterion_train, y = prediction, col = model)) +
  geom_point(alpha = .5) +
  geom_abline(slope = 1, intercept = 0) +
  labs(title = &quot;Predicting mpg$hwy&quot;,
       subtitle = &quot;Black line indicates perfect performance&quot;)

# Plot B) Violin plot of absolute errors
ggplot(data = accuracy, 
       aes(x = model, y = ae, fill = model)) + 
  geom_violin() + 
  geom_jitter(width = .05, alpha = .2) +
  labs(title = &quot;Fitting Absolute Errors&quot;,
       subtitle = &quot;Numbers indicate means&quot;,
       x = &quot;Model&quot;,
       y = &quot;Absolute Error&quot;) +
  guides(fill = FALSE) +
  annotate(geom = &quot;label&quot;, 
           x = accuracy_agg$model, 
           y = accuracy_agg$mae, 
           label = round(accuracy_agg$mae, 2))

# Step 5: Access prediction ------------------------------

# Define criterion_train
criterion_test &lt;- data_test$hwy

# Save predicted values
glm_pred &lt;- predict(hwy_glm, newdata = data_test)
rpart_pred &lt;- predict(hwy_rpart, newdata = data_test)
rf_pred &lt;- predict(hwy_rf, newdata = data_test)

#  Calculate fitting accuracies
postResample(pred = glm_pred, obs = criterion_test)
postResample(pred = rpart_pred, obs = criterion_test)
postResample(pred = rf_pred, obs = criterion_test)

# Visualise Accuracy -------------------------

# Tidy competition results
accuracy &lt;- tibble(criterion_test = criterion_test,
                   Regression = glm_pred,
                   DecisionTrees = rpart_pred,
                   RandomForest = rf_pred) %&gt;%
               gather(model, prediction, -criterion_test) %&gt;%
               # Add error measures
               mutate(se = prediction - criterion_test,
                      ae = abs(prediction - criterion_test))

# Calculate summaries
accuracy_agg &lt;- accuracy %&gt;%
                  group_by(model) %&gt;%
                  summarise(mae = mean(ae))   # Calculate MAE (mean absolute error)

# Plot A) Scatterplot of truth versus predictions
ggplot(data = accuracy,
       aes(x = criterion_test, y = prediction, col = model)) +
  geom_point(alpha = .5) +
  geom_abline(slope = 1, intercept = 0) +
  labs(title = &quot;Predicting mpg$hwy&quot;,
       subtitle = &quot;Black line indicates perfect performance&quot;)

# Plot B) Violin plot of absolute errors
ggplot(data = accuracy, 
       aes(x = model, y = ae, fill = model)) + 
  geom_violin() + 
  geom_jitter(width = .05, alpha = .2) +
  labs(title = &quot;Prediction Absolute Errors&quot;,
       subtitle = &quot;Numbers indicate means&quot;,
       x = &quot;Model&quot;,
       y = &quot;Absolute Error&quot;) +
  guides(fill = FALSE) +
  annotate(geom = &quot;label&quot;, 
           x = accuracy_agg$model, 
           y = accuracy_agg$mae, 
           label = round(accuracy_agg$mae, 2))</code></pre>
</div>
<div id="datasets" class="section level2">
<h2>Datasets</h2>
<table>
<thead>
<tr class="header">
<th align="left">File</th>
<th align="left">Rows</th>
<th align="left">Columns</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><a href="https://raw.githubusercontent.com/therbootcamp/ML_2019Oct/master/1_Data/college_train.csv">college_train.csv</a></td>
<td align="left">500</td>
<td align="left">18</td>
</tr>
<tr class="even">
<td align="left"><a href="https://raw.githubusercontent.com/therbootcamp/ML_2019Oct/master/1_Data/college_test.csv">college_test.csv</a></td>
<td align="left">277</td>
<td align="left">18</td>
</tr>
<tr class="odd">
<td align="left"><a href="https://raw.githubusercontent.com/therbootcamp/ML_2019Oct/master/1_Data/house_train.csv">house_train.csv</a></td>
<td align="left">5000</td>
<td align="left">21</td>
</tr>
<tr class="even">
<td align="left"><a href="https://raw.githubusercontent.com/therbootcamp/ML_2019Oct/master/1_Data/house_test.csv">house_test.csv</a></td>
<td align="left">1000</td>
<td align="left">21</td>
</tr>
</tbody>
</table>
<ul>
<li><p>The <code>college_train</code> and <code>college_test</code> data are taken from the <code>College</code> dataset in the <code>ISLR</code> package. They contain statistics for a large number of US Colleges from the 1995 issue of US News and World Report.</p></li>
<li><p>The <code>house_train</code> and <code>house_test</code> data come from <a href="https://www.kaggle.com/harlfoxem/housesalesprediction">https://www.kaggle.com/harlfoxem/housesalesprediction</a></p></li>
</ul>
<div id="variable-description-of-college_train-and-college_test" class="section level4">
<h4>Variable description of <code>college_train</code> and <code>college_test</code></h4>
<table>
<colgroup>
<col width="26%" />
<col width="73%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>Private</code></td>
<td align="left">A factor with levels No and Yes indicating private or public university.</td>
</tr>
<tr class="even">
<td align="left"><code>Apps</code></td>
<td align="left">Number of applications received.</td>
</tr>
<tr class="odd">
<td align="left"><code>Accept</code></td>
<td align="left">Number of applications accepted.</td>
</tr>
<tr class="even">
<td align="left"><code>Enroll</code></td>
<td align="left">Number of new students enrolled.</td>
</tr>
<tr class="odd">
<td align="left"><code>Top10perc</code></td>
<td align="left">Pct. new students from top 10% of H.S. class.</td>
</tr>
<tr class="even">
<td align="left"><code>Top25perc</code></td>
<td align="left">Pct. new students from top 25% of H.S. class.</td>
</tr>
<tr class="odd">
<td align="left"><code>F.Undergrad</code></td>
<td align="left">Number of fulltime undergraduates.</td>
</tr>
<tr class="even">
<td align="left"><code>P.Undergrad</code></td>
<td align="left">Number of parttime undergraduates.</td>
</tr>
<tr class="odd">
<td align="left"><code>Outstate</code></td>
<td align="left">Out-of-state tuition.</td>
</tr>
<tr class="even">
<td align="left"><code>Room.Board</code></td>
<td align="left">Room and board costs.</td>
</tr>
<tr class="odd">
<td align="left"><code>Books</code></td>
<td align="left">Estimated book costs.</td>
</tr>
<tr class="even">
<td align="left"><code>Personal</code></td>
<td align="left">Estimated personal spending.</td>
</tr>
<tr class="odd">
<td align="left"><code>PhD</code></td>
<td align="left">Pct. of faculty with Ph.D.’s.</td>
</tr>
<tr class="even">
<td align="left"><code>Terminal</code></td>
<td align="left">Pct. of faculty with terminal degree.</td>
</tr>
<tr class="odd">
<td align="left"><code>S.F.Ratio</code></td>
<td align="left">Student/faculty ratio.</td>
</tr>
<tr class="even">
<td align="left"><code>perc.alumni</code></td>
<td align="left">Pct. alumni who donate.</td>
</tr>
<tr class="odd">
<td align="left"><code>Expend</code></td>
<td align="left">Instructional expenditure per student.</td>
</tr>
<tr class="even">
<td align="left"><code>Grad.Rate</code></td>
<td align="left">Graduation rate.</td>
</tr>
</tbody>
</table>
</div>
<div id="variable-description-of-house_train-and-house_test" class="section level4">
<h4>Variable description of <code>house_train</code> and <code>house_test</code></h4>
<table>
<colgroup>
<col width="26%" />
<col width="73%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>price</code></td>
<td align="left">Price of the house in $.</td>
</tr>
<tr class="even">
<td align="left"><code>bedrooms</code></td>
<td align="left">Number of bedrooms.</td>
</tr>
<tr class="odd">
<td align="left"><code>bathrooms</code></td>
<td align="left">Number of bathrooms.</td>
</tr>
<tr class="even">
<td align="left"><code>sqft_living</code></td>
<td align="left">Square footage of the home.</td>
</tr>
<tr class="odd">
<td align="left"><code>sqft_lot</code></td>
<td align="left">Square footage of the lot.</td>
</tr>
<tr class="even">
<td align="left"><code>floors</code></td>
<td align="left">Total floors (levels) in house.</td>
</tr>
<tr class="odd">
<td align="left"><code>waterfront</code></td>
<td align="left">House which has a view to a waterfront.</td>
</tr>
<tr class="even">
<td align="left"><code>view</code></td>
<td align="left">Has been viewed.</td>
</tr>
<tr class="odd">
<td align="left"><code>condition</code></td>
<td align="left">How good the condition is (Overall).</td>
</tr>
<tr class="even">
<td align="left"><code>grade</code></td>
<td align="left">Overall grade given to the housing unit, based on King County grading system.</td>
</tr>
<tr class="odd">
<td align="left"><code>sqft_above</code></td>
<td align="left">Square footage of house apart from basement.</td>
</tr>
<tr class="even">
<td align="left"><code>sqft_basement</code></td>
<td align="left">Square footage of the basement.</td>
</tr>
<tr class="odd">
<td align="left"><code>yr_built</code></td>
<td align="left">Built Year.</td>
</tr>
<tr class="even">
<td align="left"><code>yr_renovated</code></td>
<td align="left">Year when house was renovated.</td>
</tr>
<tr class="odd">
<td align="left"><code>zipcode</code></td>
<td align="left">Zip code.</td>
</tr>
<tr class="even">
<td align="left"><code>lat</code></td>
<td align="left">Latitude coordinate.</td>
</tr>
<tr class="odd">
<td align="left"><code>long</code></td>
<td align="left">Longitude coordinate.</td>
</tr>
<tr class="even">
<td align="left"><code>sqft_living15</code></td>
<td align="left">Living room area in 2015 (implies some renovations). This might or might not have affected the lotsize area.</td>
</tr>
<tr class="odd">
<td align="left"><code>sqft_lot15</code></td>
<td align="left">lot-size area in 2015 (implies some renovations).</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="functions" class="section level2">
<h2>Functions</h2>
<div id="packages" class="section level3">
<h3>Packages</h3>
<table>
<thead>
<tr class="header">
<th align="left">Package</th>
<th align="left">Installation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>tidyverse</code></td>
<td align="left"><code>install.packages(&quot;tidyverse&quot;)</code></td>
</tr>
<tr class="even">
<td align="left"><code>caret</code></td>
<td align="left"><code>install.packages(&quot;caret&quot;)</code></td>
</tr>
<tr class="odd">
<td align="left"><code>partykit</code></td>
<td align="left"><code>install.packages(&quot;partykit&quot;)</code></td>
</tr>
<tr class="even">
<td align="left"><code>party</code></td>
<td align="left"><code>install.packages(&quot;party&quot;)</code></td>
</tr>
</tbody>
</table>
</div>
<div id="functions-1" class="section level3">
<h3>Functions</h3>
<table>
<colgroup>
<col width="7%" />
<col width="12%" />
<col width="80%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Function</th>
<th align="left">Package</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>trainControl()</code></td>
<td align="left"><code>caret</code></td>
<td align="left">Define modelling control parameters</td>
</tr>
<tr class="even">
<td align="left"><code>train()</code></td>
<td align="left"><code>caret</code></td>
<td align="left">Train a model</td>
</tr>
<tr class="odd">
<td align="left"><code>predict(object, newdata)</code></td>
<td align="left"><code>stats</code></td>
<td align="left">Predict the criterion values of <code>newdata</code> based on <code>object</code></td>
</tr>
<tr class="even">
<td align="left"><code>postResample()</code></td>
<td align="left"><code>caret</code></td>
<td align="left">Calculate aggregate model performance in regression tasks</td>
</tr>
<tr class="odd">
<td align="left"><code>confusionMatrix()</code></td>
<td align="left"><code>caret</code></td>
<td align="left">Calculate aggregate model performance in classification tasks</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="resources" class="section level2">
<h2>Resources</h2>
<div id="cheatsheet" class="section level3">
<h3>Cheatsheet</h3>
<figure>
<center>
<a href="https://github.com/rstudio/cheatsheets/raw/master/caret.pdf"> <img src="https://www.rstudio.com/wp-content/uploads/2015/01/caret-cheatsheet.png" alt="Trulli" style="width:70%"></a><br> <font style="font-size:10px"> from <a href= "https://github.com/rstudio/cheatsheets/raw/master/caret.pdf</figcaption">github.com/rstudio</a></font>
</figure>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
